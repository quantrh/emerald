async function loadEvents() {
  try {
    const res = await fetch('events.json');
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    eventsData = await res.json();
    eventsData.forEach(e => {
      // Giữ nguyên phần chuẩn hóa trước đó
      e.time = e.time.replace(/([A-Za-z]+,\s*[A-Za-z]+\s*\d{1,2})(?=\d)/, '$1 ');
      e.day = e.time.split(',')[0].trim();
      const m = e.time.match(/^[^,]+,\s*([A-Za-z]+\s*\d{1,2})/);
      e.dateLabel = m ? m[1] : '';
      const sm = e.time.match(/(\d{1,2}):(\d{2})\s?(AM|PM)/);
      if (sm) {
        let hr = parseInt(sm[1],10);
        if (sm[3]==='PM' && hr<12) hr+=12;
        if (sm[3]==='AM' && hr===12) hr=0;
        e.period = hr<12 ? 'Morning' : hr<17 ? 'Afternoon' : 'Evening';
      } else {
        e.period = 'All';
      }

      // —— MỚI ——: trích xuất khung giờ riêng
      const slotM = e.time.match(/(\d{1,2}:\d{2}\s?(?:AM|PM)\s*-\s*\d{1,2}:\d{2}\s?(?:AM|PM)\s*EDT)/);
      e.timeslot = slotM ? slotM[1] : '';
    });
    render();
  } catch (err) {
    console.error('Failed to load events:', err);
    counter.textContent = 'Unable to load events. Please check JSON file name.';
  }
}

function render() {
  agenda.innerHTML = '';
  let filtered = eventsData
    .filter(e => dayFilter.value==='All'    || e.day    === dayFilter.value)
    .filter(e => periodFilter.value==='All' || e.period === periodFilter.value);

  // —— Đổi so sánh sang e.timeslot ——  
  const rangeVal = rangeFilter.value;
  if (rangeVal !== 'All') {
    filtered = filtered.filter(e => e.timeslot === rangeVal);
  }

  // Các bước lọc ID và tìm kiếm giữ nguyên...
  const idTerms = idFilterInput.value.split(',').map(s=>s.trim()).filter(Boolean);
  if (idTerms.length) {
    filtered = filtered.filter(e => idTerms.includes(e.id));
  }
  const txt = searchInput.value.trim().toLowerCase();
  if (txt) {
    filtered = filtered.filter(e => (`${e.title} ${e.rawDesc}`).toLowerCase().includes(txt));
  }

  counter.textContent = `${filtered.length} events found`;
  // Phần nhóm và render ra DOM giữ nguyên...
}
